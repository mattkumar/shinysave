[{"name":"app.R","content":"library(shiny)\r\nlibrary(haven)\r\n\r\n# ui\r\nui <- fluidPage(\r\n  titlePanel(\"Shiny Save\"),\r\n  sidebarLayout(\r\n    sidebarPanel(\r\n      textInput(\"name\", \"Name\", \"\"),\r\n      tags$hr(),\r\n      radioButtons(\"upload_type\", \"Upload type:\", choices = c(\r\n        \"New .XPT\" = \"xpt\",\r\n        \"Restore Previous Session\" = \"rdata\"\r\n      )),\r\n      conditionalPanel(\r\n        condition = \"input.upload_type == 'xpt'\",\r\n        fileInput(\"upload_xpt\", \"Upload a .XPT file\")\r\n      ),\r\n      conditionalPanel(\r\n        condition = \"input.upload_type == 'rdata'\",\r\n        fileInput(\"upload_rdata\", \"Upload a .RData file\")\r\n      ),\r\n      tags$hr(),\r\n      downloadButton(\"save\", \"Save Current Session\")\r\n    ),\r\n    mainPanel(\r\n      h3(\"Output\"),\r\n      tableOutput(\"table\"),\r\n      h3(\"Contents\"),\r\n      verbatimTextOutput(\"debug\")\r\n    )\r\n  )\r\n)\r\n\r\n# server\r\nserver <- function(session, input, output) {\r\n  \r\n  # Tracker\r\n  tracker <- reactiveValues()\r\n  \r\n  # New XPT logic\r\n  observeEvent(input$upload_xpt,{\r\n    req(input$upload_xpt)\r\n    tracker$raw_xpt <- readBin(input$upload_xpt$datapath, \"raw\", file.info(input$upload_xpt$datapath)$size)\r\n    tmp_file <- tempfile(fileext = \".xpt\")\r\n    writeBin(tracker$raw_xpt, tmp_file)\r\n    tracker$processed_xpt <- haven::read_xpt(tmp_file)\r\n  })\r\n  \r\n  # Saved Session logic\r\n  observeEvent(input$upload_rdata, {\r\n    req(input$upload_rdata)\r\n    saved_state <- readRDS(input$upload_rdata$datapath)\r\n    tracker$raw_xpt <- saved_state$tracker$raw_xpt\r\n    updateTextInput(session, inputId = \"name\", value = saved_state$name)\r\n    tmp_file <- tempfile(fileext = \".xpt\")\r\n    writeBin(tracker$raw_xpt, tmp_file)\r\n    tracker$processed_xpt <- haven::read_xpt(tmp_file)\r\n  })\r\n  \r\n  # Save logic\r\n  output$save <- downloadHandler(\r\n    filename = function() {\r\n      \"saved_session.RData\"\r\n    },\r\n    content = function(file) {\r\n      saveRDS(list(tracker = reactiveValuesToList(tracker), name = input$name), file)\r\n    }\r\n  )\r\n  \r\n  # Display logic\r\n  output$table <- renderTable({\r\n    req(tracker$processed_xpt)\r\n    head(tracker$processed_xpt)\r\n  })\r\n  \r\n  # Display contents\r\n  output$debug <- renderPrint({\r\n    reactiveValuesToList(tracker)\r\n  })\r\n  \r\n}\r\n\r\n# run app\r\nshinyApp(ui, server)\r\n","type":"text"}]
